<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Project 2: Branches - Loops - Error handling - CS502 by Tiark Rompf</title>

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-39122235-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-39122235-1');
    </script>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="javascripts/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <style>
      table {
          font-family: arial, sans-serif;
          border-collapse: collapse;
          width: 100%;
      }
      
      td, th {
          border: 1px solid #dddddd;
          text-align: left;
          padding: 8px;
      }
      
      tr:nth-child(even) {
          background-color: #dddddd;
      }
    </style>
    
  </head>
  <body>
    <div class="wrapper">
      <header class="without-description">
        <h1>CS502</h1>
        <p></p>
        <p class="view"><a href="https://github.com/TiarkRompf/cs502">View the Project on GitHub <small>TiarkRompf/cs502</small></a></p>
        <ul>
          
          <li><a href="index.html"><strong>Home</strong></a></li>
          
          <!--<li><a href="https://github.com/TiarkRompf/cs502">View On <strong>GitHub</strong></a></li>-->
        </ul>
      </header>
      <section>
        <div class="title">
          <h1>Project 2: Branches - Loops - Error handling</h1>
        </div>
        <blockquote>
  <p>Due 11:59pm Sunday Sep 3</p>
</blockquote>

<h2 id="useful-links">Useful Links</h2>

<ul>
  <li><a href="https://cs.brown.edu/courses/cs033/docs/guides/x64_cheatsheet.pdf" target="_blank">x86_64 cheat sheet (up to page 4 for this
project)</a></li>
</ul>

<h2 id="introduction">Introduction</h2>

<p>In this project, we will enrich the simple arithmetic expression
language we defined in the first project.</p>

<p>At the end of the project, we will be able to parse full programs; the
only things missing will be functions and arrays. Our parser will
generate an intermediate representation in the form of an Abstract
Syntax Tree (AST).</p>

<h2 id="step-1-getting-started">Step 1: Getting Started</h2>

<p>The project has been designed and tested for Linux/Mac OS. If you only
have Windows installed on your personal laptop, consider running Linux
in a VM or using the lab machines for the project.</p>

<p>If you use remote access to work on your project, please use one of the
lab machines pod1-1 to pod1-20 with the suffix cs.purdue.edu (e.g.
pod1-1.cs.purdue.edu)</p>

<p>Download the skeleton file
<a href="https://www.cs.purdue.edu/homes/jia137/cs502/proj2.zip" target="_blank">here</a>.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>unzip proj2.zip
cd proj2
</code></pre></div></div>

<h2 id="step-2-project-structure">Step 2: Project Structure</h2>

<h3 id="browse-the-files">Browse the Files</h3>

<p>A description of the different files is provided below. The files you
need to complete are <strong>Parser.scala</strong>, <strong>SemanticAnalyzer.scala</strong>,
<strong>Interpreter.scala</strong>, and <strong>Compiler.scala</strong>. Following the path of the
first project, we are going to implement the parser step by step. Follow
the comments in the code and find the <strong>TODOs</strong>. The other part are also
independent and can be develop separately.</p>

<h3 id="srcmainscalaproject2utilscala">src/main/scala/project2/Util.scala</h3>

<p>This file defines multiple classes that are used to generate the code
and run it on your machine. Nothing needs to be modified, but it is
recommanded to read it and have an idea of what is happening behind the
scenes.</p>

<h3 id="genbootstrapc">gen/bootstrap.c</h3>

<p>As we are generating assembly code which is OS dependent, we are using
GCC to do the heavy lifting for us. The boostrap file is a generic C
file that is calling a function <strong>entry_point</strong> and is printing the
result in <strong>stdout</strong>. Our compiler will generate the file <strong>gen/gen.s</strong>
and will be assembled and bootstrapped by gcc:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gcc bootstrap.c gen.s -o out
</code></pre></div></div>

<p><strong>out</strong> will then print the result of our compiled expression.</p>

<h3 id="srcmainscalaproject2mainscala">src/main/scala/project2/Main.scala</h3>

<p>The main function is defined in this file. The data flow in this file
can be seen as:</p>

<blockquote>
  <p>Read from File / Read from Command Line -&gt; Parser -&gt; Semantic Analyzer -&gt; Interpreter <strong>or</strong> Compiler</p>
</blockquote>

<p>You will be implementing many different parsers in order to test them
through the main function.</p>

<p>The AST generated will then go through the semantic analyzer. If there
are no errors, then the code is going to be interpreted or compiled. We
provide you with one interpreter and one compiler. You will have to
write one of each yourself.</p>

<p>As our language becomes more complex, it will become more useful to read
the code from a source file. A folder with sample files <strong>examples/</strong>
has been provided. Here some examples how to run the code:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sbt
&gt; run
Usage: run PROG [OPTION]
   or: run FILE [OPTION]
OPTION: compX86, intStack, intValue (default)
&gt; run examples/valid_arithm.scala              ---&gt; interpreter with the provided interpreter
&gt; run examples/valid_arithm.scala compX86      ---&gt; x86 compiler (your code)
&gt; run examples/valid_arithm.scala intStack     ---&gt; stack interpreter (your code)
</code></pre></div></div>

<p>However, it is still possible to run code from the command line, as in
project 1:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sbt
&gt; run "val x = 5; x"
&gt; run "val x = 5; x" compX86
&gt; run "val x = 5; x" intStack
</code></pre></div></div>

<h3 id="srcmainscalaproject2parserscala">src/main/scala/project2/Parser.scala</h3>

<p>This class contains the definition of our intermediate language.</p>

<p>As we discussed in class, parsing the file one character at a time is
not enough when we introduce more complex constructs. Also, our single
digit numbers were a little bit limiting. The <strong>Scanner</strong> class defined
in this file tokenizes the code. You will have to implement the
<strong>getNum</strong> method. Check out the other methods implemented there, as
they are going to be useful for the next part.</p>

<p>The rest of the file is the definition of each parser we are building,
starting from a generic precedence arithmetic parser to the full
language we want to target, including variables, if statements, and
loops. What you have to do for this project is highlighted with TODOs in
the code. We encourage you to read the comments and code carefully
before proceeding.</p>

<h3 id="srcmainscalaproject2semanticanalyzerscala">src/main/scala/project2/SemanticAnalyzer.scala</h3>

<p>While the parser is in charge of verifying that the input string follows
the defined syntax, the semantic analyzer verifies that the program
described is meaningful and follows the rules. For example:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>val x = 2; x = 5
</code></pre></div></div>

<p>has a valid syntax. However 'val' is immutable: it is not allowed to
be reassigned to.</p>

<p>Using the functions <strong>error</strong> and <strong>warn</strong>, enforce the following
semantic rules:</p>

<ul>
  <li>unary operators supported "+", "-". Raise: undefined unary
operator</li>
  <li>binary operators supported "+", "-", "/", "*". Raise:
undefined binary operator</li>
  <li>boolean operators supported "==", "!=", "&lt;=", "&gt;=",
"&lt;", "&gt;". Raise: undefined boolean operator</li>
  <li>'val' can not be assigned. Raise: reassignment to val</li>
  <li>identifier needs to be defined in the current scope before being
used. Raise: undefined identifier</li>
</ul>

<p>Note that we allow a variable to be declared multiple times. The last
definition will be used when a reference to it is found. In this case
only a warning is raised.</p>

<h3 id="srcmainscalaproject2interpreterscala">src/main/scala/project2/Interpreter.scala</h3>

<p>As we have seen in class, now that our programing language accepts more
than just mathematical expressions, we need to define the required
behavior of our language. An interpreter can be used to define this
meaning.</p>

<p>We provide you with an interpreter that is fully functional. Your job is
to complete the <strong>Stack-based</strong> interpreter.</p>

<h3 id="srcmainscalaproject2compilerscala">src/main/scala/project2/Compiler.scala</h3>

<p>In this file, one compiler emitting Scala-like code has already been
implemented. You need to implement a second compiler that can convert
our AST into x86_64 code.</p>

<p>In the previous project, we considered two different ways of generating
the assembly code, each of which has pros and cons: <strong>Stack-based</strong>
code, which is not very efficient, but can handle arbitrarily complex
expressions; and <strong>Register-based</strong> code, which is efficient, but can
not handle arbitrarily complex expressions. <strong>For this assignment, we
will use a register-based approach.</strong></p>

<h3 id="tests-srctestscalaproject2testscala">Tests src/test/scala/project2/*Test.scala</h3>

<p>These files contain some unit tests for the first parsers. <mark>You will
have to write your own tests for the others. Every task should have at
least 2 tests otherwise points will be deducted.</mark> There are some
functions given to you in order to make the implementation easier.</p>

<h2 id="turnin">Turnin</h2>

<p>You should turn in the <strong>proj2</strong> directory. Please run an 'sbt clean'
and './cleanall.sh' before submitting.</p>

<p>To turn in your project create a ZIP file named
<code class="language-plaintext highlighter-rouge">&lt;purdueemailusername&gt;-proj&lt;N&gt;.zip</code> of the <code class="language-plaintext highlighter-rouge">proj2</code> directory for
example <code class="language-plaintext highlighter-rouge">axhebraj-proj2.zip</code> and upload it to the corresponding
assignment on Brightspace.</p>

<p><strong>No other file formats or naming conventions will be accepted as
submissions. Verify your submission by downloading the ZIP file you
uploaded on Brightspace and extracting its content. The uncompressed
content should be the <code class="language-plaintext highlighter-rouge">proj2</code> folder containing the code.</strong></p>

<h2 id="grading">Grading</h2>

<p>Your project will be tested against a set of unit tests. The weights of
each task will be distributed as follow:</p>

<table>
  <thead>
    <tr>
      <th>Task</th>
      <th>Weight</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Scanner.getNum</td>
      <td>5%</td>
    </tr>
    <tr>
      <td>ArithParser</td>
      <td>10%</td>
    </tr>
    <tr>
      <td>LetParser</td>
      <td>5%</td>
    </tr>
    <tr>
      <td>BranchParser</td>
      <td>10%</td>
    </tr>
    <tr>
      <td>VariableParser</td>
      <td>15%</td>
    </tr>
    <tr>
      <td>LoopParser</td>
      <td>5%</td>
    </tr>
    <tr>
      <td>SemanticAnalyzer</td>
      <td>10%</td>
    </tr>
    <tr>
      <td>StackInterpreter</td>
      <td>15%</td>
    </tr>
    <tr>
      <td>X86Compiler</td>
      <td>25%</td>
    </tr>
  </tbody>
</table>

      </section>
    </div>
    <footer>
      <p>Project maintained by <a href="https://github.com/TiarkRompf">TiarkRompf</a></p>
      <p>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></p>
    </footer>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

  </body>
</html>
