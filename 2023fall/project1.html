<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Project 1: Arithmetic Expressions - CS502 by Tiark Rompf</title>

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-39122235-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-39122235-1');
    </script>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="javascripts/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <style>
      table {
          font-family: arial, sans-serif;
          border-collapse: collapse;
          width: 100%;
      }
      
      td, th {
          border: 1px solid #dddddd;
          text-align: left;
          padding: 8px;
      }
      
      tr:nth-child(even) {
          background-color: #dddddd;
      }
    </style>
    
  </head>
  <body>
    <div class="wrapper">
      <header class="without-description">
        <h1>CS502</h1>
        <p></p>
        <p class="view"><a href="https://github.com/TiarkRompf/cs502">View the Project on GitHub <small>TiarkRompf/cs502</small></a></p>
        <ul>
          
          <li><a href="index.html"><strong>Home</strong></a></li>
          
          <!--<li><a href="https://github.com/TiarkRompf/cs502">View On <strong>GitHub</strong></a></li>-->
        </ul>
      </header>
      <section>
        <div class="title">
          <h1>Project 1: Arithmetic Expressions</h1>
        </div>
        <blockquote>
  <p>Due 11:59pm Sunday Aug 27</p>
</blockquote>

<h2 id="useful-links">Useful Links</h2>

<ul>
  <li><a href="https://cs.brown.edu/courses/cs033/docs/guides/x64_cheatsheet.pdf" target="_blank">x86_64 cheat sheet (up to page 3 for this project)</a></li>
</ul>

<h2 id="introduction">Introduction</h2>

<p>The goal of this project is to setup the environment and to learn how to
parse and translate mathematical expressions into x86_64 assembly code.
Our approach will be simple and the objective is to highlight some of
the key aspects and ideas behind a compiler.</p>

<p>For this first project, we are going to keep things very simple and take
very small steps. Make sure that you understand everything correctly
before going to the next step.</p>

<p>At the end of the project, we will be able to parse mathematical
expressions with single digit numbers, addition, substraction,
multiplication, division, and parentheses. Our parser will generate an
intermediate representation in the form of an Abstract Syntax Tree
(AST). The definition of the AST is the one used during the lecture.</p>

<p>In parallel, we will implement a generator that converts the AST into
x86_64 code.</p>

<p>Here is a small example of what we will be able to generate by the end
of the project:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[info] Running project1.Runner 2+3
============= AST ================
    Plus(Lit(2),Lit(3))
==================================

============ OUTPUT ==============
.text
    .global entry_point

entry_point:
    push %rbp   # save stack frame for C convention
    mov %rsp, %rbp

    # beginning generated code
    movq $2, %rbx
    movq $3, %rcx
    addq %rcx, %rbx
    movq %rbx, %rax
    # end generated code
    # %rax contains the result

    mov %rbp, %rsp  # reset frame
    pop %rbp
    ret



==================================
Result: 5
</code></pre></div></div>

<h2 id="step-1-getting-started">Step 1: Getting Started</h2>

<p>The first step of this assignment is to set up your environment as
described in the <a href="getting_started.html">Getting Started - Tools page</a>.
If you have any trouble installing the tools for the course, ask the for
help on Piazza as soon as possible. TAs or other students might help
troubleshoot and solve your issue.</p>

<p>You can do the project on your own machine or lab machines and then
upload your submission on Brightspace.</p>

<p>The project has been designed and tested for Linux/Mac OS. If you have
only Windows installed on your laptop consider running Linux in a VM, or
use the lab machines for the project. (However it should be working on
Windows as well)</p>

<p>If you use remote access to work on your project, please use one of the
lab machines data/pod1-1 to pod1-20 with the suffix cs.purdue.edu (e.g.
pod1-1.cs.purdue.edu, data.cs.purdue.edu)</p>

<p>Download the skeleton file
<a href="https://www.cs.purdue.edu/homes/jia137/cs502/proj1.zip" target="_blank">proj1.zip</a>.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>unzip proj1.zip
cd proj1
</code></pre></div></div>

<h2 id="step-2-project-structure">Step 2: Project Structure</h2>

<h3 id="open-project-in-your-favorite-scala-ide">Open Project in Your Favorite Scala IDE</h3>

<h3 id="browse-the-files">Browse the Files</h3>

<p>A description of the different files is provided below. The two files
you need to complete are <strong>Parser.scala</strong> and <strong>Generator.scala</strong>. Each
parser that we are going to implement builds on top of another, so you
need to implements them in order by following the comments in the code.
We will implement two different generators using two different
strategies. It is recommended to implement the <strong>StackASMGenerator</strong>
class when it is suggested in the <strong>Parser.scala</strong> file, and implement
the <strong>RegASMGenerator</strong> at the end.</p>

<h3 id="buildsbt-and-projectpluginsbt">build.sbt and project/plugin.sbt</h3>

<p>The Scala Build Tool (sbt) is an open source build tool for Scala and
Java projects. These files contain the information necessary to compile
this project. You should not have to modify them.</p>

<p>To use sbt, launch a terminal and go to the project directory (proj1)
and enter <code class="language-plaintext highlighter-rouge">sbt</code>. It will lauch an sbt console. You can run the program
from there:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>run "arg1" "arg2" // run main program with arguments arg1 and arg2
run "1+3*(5-8)"
test              // run all the tests application (in src/test)
</code></pre></div></div>

<h3 id="srcmainscalaproject1utilscala">src/main/scala/project1/Util.scala</h3>

<p>This file defines multiple classes that are used to generate the code
and run it on your machine. Nothing needs to be modified, but it is
recommanded to read it and have an idea of what is happening behind the
scenes.</p>

<h3 id="genbootstrapc">gen/bootstrap.c</h3>

<p>As we are generating assembly code which is OS dependent, we are using
GCC to do the heavy lifting for us. The boostrap file is a generic C
file that is calling a function <strong>entry_point</strong> and is printing the
result in <strong>stdout</strong>. Our compiler will generate the file <strong>gen/gen.s</strong>
and will be assembled and bootstrapped by gcc:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gcc bootstrap.c gen.s -o out
</code></pre></div></div>

<p><strong>out</strong> will then print the result of our compiled expression.</p>

<p>NOTE: the assembly/compilation and running steps are executed through
the code. (see Util.scala#L88 and Main.scala#L39)</p>

<h3 id="srcmainscalaproject1mainscala">src/main/scala/project1/Main.scala</h3>

<p>The main function is defined in this file. During this project, you will
be implementing many different parsers in order to test them through the
main function. You will need to modify the parser or generator you want
to use.</p>

<h3 id="srcmainscalaproject1parserscala">src/main/scala/project1/Parser.scala</h3>

<p>This class contains the definition of our intermediate language. This is
the language we are using in class; please refer to the lecture for more
information.</p>

<p>The class <strong>SimpleParser</strong> defined in this file is the basic parser that
we are going to use for this project. It is reading a stream of
characters one at a time and can extract a single digit number
<strong>getNum</strong> or a single letter name <strong>getName</strong>. It does not handle
whitespace.</p>

<p>We are keeping the parser very simple at the beginning to focus on the
important concepts. Later on, we will improve it to handle multiple
digits numbers and more expressions. We will also support whitespace.</p>

<p>The rest of the file is the definition of each parser we are building,
starting from single number expressions to the full language we want to
target. What you have to do for this project is highlighted with TODOs
in the code. We encourage you to read the comments and code carefully
before proceeding.</p>

<h3 id="srcmainscalaproject1generatorscala">src/main/scala/project1/Generator.scala</h3>

<p>In this file, we are defining some generators that can convert our AST
into x86_64 code.</p>

<p>We consider two different ways of generating the assmbly code, each of
which has pros and cons: <strong>Stack-based</strong> code, which is not very
efficient but can handle arbitrarily complex expressions; and
<strong>Register-based</strong> code, which is efficient but can not handle
arbitrarily complex expressions. We will see later that compilers use a
hybrid approach.</p>

<h3 id="srctestscalaproject1testtestscala">src/test/scala/project1/test/*Test.scala</h3>

<p>These files contain some unit tests for the first parsers. You will have
to write your own tests for the others. There are some functions given
to you in order to make the implementation easier.</p>

<h2 id="turnin">Turnin</h2>

<p>You should turn in the <strong>proj1</strong> directory. Please run an ‘sbt clean’
and ‘./cleanall.sh’ before submitting.</p>

<p>To turn in your project create a ZIP file named
<code class="language-plaintext highlighter-rouge">&lt;purdueemailusername&gt;-proj&lt;N&gt;.zip</code> of the <code class="language-plaintext highlighter-rouge">proj1</code> directory for
example <code class="language-plaintext highlighter-rouge">axhebraj-proj1.zip</code> and upload it to the corresponding
assignment on Brightspace.</p>

<p><strong>No other file formats or naming conventions will be accepted as
submissions. Verify your submission by downloading the ZIP file you
uploaded on Brightspace and extracting its content. The uncompressed
content should be the <code class="language-plaintext highlighter-rouge">proj1</code> folder containing the code.</strong></p>

<h2 id="grading">Grading</h2>

<p>Your project will be tested against a set of unit tests. The weights of
each task will be distributed as follow:</p>

<table>
  <thead>
    <tr>
      <th>Task</th>
      <th>Weight</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>parseTerm</td>
      <td>20%</td>
    </tr>
    <tr>
      <td>parseFactor</td>
      <td>20%</td>
    </tr>
    <tr>
      <td>StackASMGenerator</td>
      <td>30%</td>
    </tr>
    <tr>
      <td>RegASMGenerator</td>
      <td>30%</td>
    </tr>
  </tbody>
</table>

      </section>
    </div>
    <footer>
      <p>Project maintained by <a href="https://github.com/TiarkRompf">TiarkRompf</a></p>
      <p>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></p>
    </footer>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

  </body>
</html>
