<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>CS502 by TiarkRompf</title>

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-39122235-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-39122235-1');
    </script>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="javascripts/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header class="without-description">
        <h1>CS502</h1>
        <p></p>
        <p class="view"><a href="https://github.com/TiarkRompf/cs502">View the Project on GitHub <small>TiarkRompf/cs502</small></a></p>
        <ul>
          <li><a href="index.html"><strong>Home</strong></a></li>
        </ul>
      </header>
      <section>
<!--content-->

      <div class="title">
        <h1>Project 1: L3 Desugaring</h1>
      </div>

<p>The purpose of this first assignment is to get familar with the L3 language and the existing code base of the L3 compiler and interpreter. You should take it seriously, as it guides you through the L3 code base and it explains how to set up the tools that will make code development efficient. This assignment will require completing 5 steps:</p>
<ul>
	<li><a href="#s1">Set up the Infrastructure</a> (as discussed in the <a href="project0.html">Getting Started page</a>)</li>
	<li><a href="#s2">Provide the Desugaring Implementation for the L3 Compiler</a></li>
	<li><a href="#s3">Provide Three Test Cases for the Desugaring</a></li>
	<li><a href="#s4">Implement a Function in the L3 Library</a></li>
	<li><a href="#s5">Submit the Assignment</a><br />
	</li>
</ul>
<h4><a id="s1">Step 1: Setting up the Infrastructure</a></h4>
<p>The first step of this assignment is to set up your environment, as described in the <a href="project0.html">Getting Started - Tools page</a>. If you have any trouble installing the tools for the course ask the TAs for help. Note that all of the prerequisites, even Eclipse, are installed on the CS department linux machines, and you are free to use an X server such as <a href="https://sourceforge.net/projects/xming/">xming</a> to do the project remotely. Alternatively you may do the project on your own machine and then upload your results to your home directory on data.cs.purdue.edu and turn in your results using turnin.</p>
<h4>Download the Skeleton Code:</h4>
<p>The skeleton code is available at <a href="https://www.cs.purdue.edu/homes/rompf/cs502/project/proj1.tgz">https://www.cs.purdue.edu/homes/rompf/cs502/project/proj1.tgz</a> See the course Piazza for access credentials. To download the code from a Linux terminal, go into the directory that you intend to use for the course (e.g ~/cs502) and do the following:</p>
<pre>
wget https://www.cs.purdue.edu/homes/rompf/cs502/project/proj1.tgz --http-user=USER --http=password=PASS
tar -xvf proj1.tgz
cd proj1
</pre>
<h4><a id="s2">Step 2: Desugaring in the L3 compiler</a></h4>
<p>Now you should have decompressed the skeleton code and should have found a&nbsp;<em>compiler</em> directory<em>:</em></p>
<pre>
$ cd proj1
$ cd compiler
$ sbt compile
$ sbt eclipse
</pre>
<p>After running <em>sbt eclipse</em> you should be able to load the project in Eclipse using <em>File &gt; Import...</em> and <em>General &gt; Existing Projects into Workspace</em> and point Eclipse to the <em>acc2016-groupXX </em>directory. It should load a project called <em>l3-compiler,&nbsp;</em><a style="background-color: rgb(255, 255, 255); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal;" href="#eclipse">as described here</a>.</p>
<p>Now, run the program <em>examples/hello.l3</em>. This can be done in two ways:</p>
<ul>
	<li>using Eclipse&nbsp;<span style="font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal;">(</span><a style="font-style: normal; font-size: 13px; font-family: Arial, Helvetica, sans-serif; background-color: rgb(255, 255, 255);" href="#eclipse">as described here</a><span style="font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal;">)</span>, by indicating the main class <em>l3.Main&nbsp;</em>with the argument "<em>../examples/hello.l3</em>" or</li>
	<li><a href="#sbt">using sbt</a>:</li>
</ul>
<pre style="margin-left: 40px;">
$ sbt "run ../examples/hello.l3"
[info] Loading project definition from ...
[info] Set current project to l3-compiler (in build file:...)
[info] Running l3.Main ../examples/hello.l3
[error] (run-main) <strong>scala.NotImplementedError: an implementation is missing</strong>
</pre>
<p>You will notice that it fails with a &ldquo;not implemented&rdquo; error (with a long stacktrace). Your next task is to add the missing pieces to the syntactic sugar translation. Navigate to the bottom of file <em>src</em><em>/l3/L3Parser.scala</em>. You will notice that some methods are implemented in terms of a <strong>???</strong> method, which throws a runtime exception. Rewrite those method bodies according to the rewrite rules on the slides shown in this week's lecture.</p>
<p>Once you provided implementations for <em>sBegin</em> and <em>sFun</em> in <em>src/l3/</em><em>L3Parser.scala</em> you should be able to run the <em>hello.l3</em> example. Now implement all the other desugaring methods.</p>
<p>&nbsp;</p>
<h4><a id="s3">Step 3: Test cases for the desugaring</a></h4>
<p>As you are developing the desugaring, it would be good to verify your implementation. For this assignment, you have tests that make sure your desugaring is correct. There are two categories of tests: whitebox tests, which verify the trees you generate (<em>L3DesugaringWhitebox.scala</em>) and blackbox tests, which check the output of running the compiled program (<em>L3DesugaringBlackbox.scala</em>). To run the tests, it is easiest to navigate to the <em>l3.test</em><strong> </strong>package in the <em>test/</em><strong>&nbsp;</strong>directory and open up one of the files. Then from the <em>Run</em> menu select <em>Run As&nbsp;&gt; Scala JUnit Test</em>. You can also use sbt:</p>
<pre>
$ sbt test
[info] Test run started
...
[error] Failed: : Total 21, <strong>Failed 3</strong>, Errors 0, Passed 18, Skipped 0
...
</pre>
<p>Even with a perfect implementation the last three whitebox tests will fail. Your next task is to complete the test suite so all tests pass. To do this, have a look at methods <em>testSAnd,</em> <em>testSOr </em>and <em>testSNot</em><strong> </strong>in <em>test/l3/test/L3DesugaringWhitebox.scala</em>. They contain <strong>???&nbsp;</strong>instead of the expected output. Fill in the correct tree so the test suite passes.</p>
<h5>&nbsp;</h5>
<h4><a id="s4">Step 4: Completing the Library Code</a></h4>
<p>Once you are done with the desugaring and all tests pass, run <em>printint.l3</em> and enter a number when asked to.</p>
<pre>
&gt; run ../library/lib.ml3 ../examples/printint.l3
[info] Running l3.Main ../library/lib.ml3 ../examples/printint.l3
Enter a number: 12
<strong>You entered</strong>
[success] Total time: 2 s, completed Feb 15, 2013 4:03:13 AM
</pre>
<p>You will notice that it cannot  print the number you have entered: it is missing a library function  int-print that accepts a number and prints it to the console. Your last task is to add the body of <em>int-print</em> in <em>library/integers.l3</em> such that it prints the correct output.  Make sure it prints a given number to the base of 10 and that it can  handle negative numbers as well. Hint: implement it recursively in terms  of <em>char-print </em>and<em>&nbsp;int-&gt;char-digit</em>. Modify printint.l3 so that it prints the number you have  entered and verify that it runs correctly.</p>
<p>&nbsp;</p>
<h4><a id="s5">Step 5: Submitting the Assignment</a></h4>
<p>At this point everything should be working: compiler code should be ready, local tests should be passing and all examples should be running fine. When you are comfortable with the status of your project, it's time to use the <i>turnin</i> command on one of the CS machines to submit your code. You may use data.cs.purdue.edu or any of the lab machines. If you developed your assignment on a different machine, make sure to copy your files to one of the CS machines remotely before running the turnin command.</p>
<p>To turn in your project, go to the same directory that your <i>proj1</i> directory lives in (you do not have to name it proj1, but it must contain all of the project files) and type:<br>
<pre>
turnin -c cs502 -p project1 proj1
</pre>
<p>You can verify the status of your turned in project by running:</p>
<pre>
turnin -c cs502 -p project1 -v
</pre>
</p>
<p>The rest of this page describes the use of <a href="#sbt"><em>sbt</em></a> and <a href="#eclipse"><em>Eclipse</em></a> in this assignment.</p>
<p>&nbsp;</p>
<h4><a id="sbt">Tutorial: Simple Build Tool (sbt) for the l3 compiler</a></h4>
<p>Simple Build Tool performs a series of tasks for you:</p>
<ul>
	<li>manages dependecies of your project (you will see it "downloading the Internet" the first time you run it)</li>
	<li>compiles your project</li>
	<li>runs the main class of your project</li>
	<li>runs the test suite</li>
	<li>creates eclipse project files</li>
	<li>packages your project for submission</li>
</ul>
<p>Sbt can work in two modes: as a command-line tool, invoked with</p>
<pre>
$ sbt &lt;task&gt;
</pre>
<p>and as a console:</p>
<pre>
$ sbt
...
[info] Set current project to acc-1 (in build file:/...)
&gt; &lt;task&gt;
...
&gt;
</pre>
<p>Both the console and the command line have a series of common useful tasks:</p>
<ul>
	<li><em>compile</em> will compile your project</li>
	<li><em>run &lt;args&gt;</em> will run the main class of your project</li>
	<li><em>eclipse</em><strong> </strong>create eclipse project files so you can import the project in Eclipse</li>
	<li><em>test</em><strong> </strong>run the test suite</li>
	<li><em>test-only &lt;test&gt;</em><strong> </strong>run a single test</li>
	<li><em>package</em><strong> </strong>create a jar file with the classes</li>
	<li><em>package-src</em><strong> </strong>creates a jar file with the source files</li>
	<li><em>update</em><strong> </strong>refreshes the dependencies ("downloads the Internet" again)</li>
</ul>
<p>Preceeding any of the task with "~" (tilda, no quotes) will run the task each time you change a file:</p>
<pre>
$ sbt '~test-only my.Test' # quotes are necessary to prevent the shell from expanding ~ to /home/$USER
...
1. Waiting for source changes... (press enter to interrupt)

</pre>
<h4><a id="eclipse">Tutorial: Eclipse for the L3 Compiler</a></h4>
<p>In order to work on the compiler in Eclipse you need to create the Eclipse project files. It is easiest to do using sbt:</p>
<pre>
$ sbt eclipse
</pre>
<p>Don't worry about the errors shown by sbt -- it is set to download source archives for all the projects the compiler depends on -- and some of the source archives are not available, but this will not affect the Eclipse functionality.</p>
<p>To add the project in Eclipse, from the <em>File</em> menu, choose <em>Import..</em> and then <em>General &gt; Existing Projects into Workspace</em>. For the root directory, pick the directory where you unpacked the exercise sources. Eclipse should locate the<strong> </strong><em>l3-compiler</em> project that sbt created and import it.&nbsp;</p>
<p>You will now need to specify that the project needs to be compiled with the Java 8 library. In the Package Explorer on the left, right-click on your project and go to Properties-&gt; Java build path -&gt; Add library -&gt; JRE system library. Click on alternate JRE -&gt; Installed JREs -&gt; Add, and navigate to the home directory of your Java 8 installation.</p>
<p>You can now build and run the L3 compiler / interpreter directly in Eclipse. If you get errors regarding the econding of the source files while building the project, you have to make the project encoding as UTF-8 in the project properties -&gt; resource menu.&nbsp;For running (or debugging) create a new <em>Run Configuration</em> of type <em>Scala Application</em> and specify <em>l3.Main</em> as main class. You have to specify one ore more source files as the arguments (<em>../examples/hello.l3</em> is a good start).</p>
<p>You can also run the test suite from within Eclipse. For the first assignment, you have two test suites:</p>
<ul>
	<li><em>l3.test.L3DesugaringWhitebox</em> tests the trees that are output from your transformation</li>
	<li style="font-size: 13px;"><em style="font-size: 13px;">l3.test.L3DesugaringBlackbox</em>&nbsp;tests the transformation based on running the resulting program (blackbox test cannot be executed in Eclipse, only in sbt)</li>
</ul>
<p>To run a test suite, you can use either <em>sbt test</em> or navigate to the test suite source file (in the test directory), open the test suite file and choose <em>Run&nbsp;&gt; Run as &gt; Scala JUnit Test</em> from the menu.</p>
<p>A good video on using Eclipse can be found on the <a href="http://scala-ide.org/">ScalaIDE main page</a>.</p>


<!--/content-->

      </section>
    </div>
    <footer>
      <p>Project maintained by <a href="https://github.com/TiarkRompf">TiarkRompf</a></p>
      <p>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></p>
    </footer>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

  </body>
</html>